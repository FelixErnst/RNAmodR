---
title: "RNAmod: pre-mapping preparation of genome and annotation"
author: "Felix G.M. Ernst"
date: "`r Sys.Date()`"
package: RNAmodR
abstract: >
  Example conversion of extracting of sequences and annotation to construct a
  special transcriptome to map reads against
output: 
  BiocStyle::html_document:
    toc: true
    toc_float: true
    df_print: paged
vignette: >
  %\VignetteIndexEntry{RNAmod - pre-mapping preparation of genome and annotation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r style, echo = FALSE, results = 'asis'}
BiocStyle::markdown(css.files = c('custom.css'))
```

# Introduction

```{r tRNA,eval=FALSE}
library(RNAmodR)
matchFastaToGff <- function(gfffile, fafile){
  gff <- rtracklayer::import.gff3(gfffile)
  fsa <- Biostrings::readDNAStringSet(fafile)
  names(fsa) <- unique(as.character(GenomeInfoDb::seqnames(gff)))
  Biostrings::writeXStringSet(fsa, fafile)
}
```

# Converting rRNA, mRNA and tRNA genes to seperate chromosomes

## S. cerevisiae

```{r sacCer3,eval=FALSE}
folder <- "genomes/sacCer3/"
gfffile <- paste0(folder,"sacCer3_R64-2-1.gff3")
fafile <- paste0(folder,"sacCer3_R64-2-1.fasta")
tRNAscanfile <- paste0(folder,"sacCer3-tRNAs.ss.sort")
matchFastaToGff(gfffile, fafile)

# get specific rRNA genes and save as fasta/gff
gff <- rtracklayer::import.gff3(gfffile)
RDN25 <- S4Vectors::mcols(gff[grepl("RDN25",S4Vectors::mcols(gff)$ID),])$ID
RDN18 <- S4Vectors::mcols(gff[grepl("RDN18",S4Vectors::mcols(gff)$ID),])$ID
RDN58 <- S4Vectors::mcols(gff[grepl("RDN58",S4Vectors::mcols(gff)$ID),])$ID
RNDmt <- c(S4Vectors::mcols(gff[grepl("Q0020",S4Vectors::mcols(gff)$ID),])$ID,
           S4Vectors::mcols(gff[grepl("Q0158",S4Vectors::mcols(gff)$ID),])$ID)
rRNAFiles <- convertGeneToChrom(gfffile,
                                fafile,
                                c(RDN25,RDN18,RDN58,RNDmt),
                                "rRNA",
                                removeDuplicateSeqs = TRUE)
# Remove specific tRNA genes and append to fasta/gff
tRNAFiles <- converttRNAscanToChrom(gfffile,
                                    fafile,
                                    tRNAscanfile,
                                    "tRNAscan")
# append all the files
out_fafile <- appendFastaFiles(rRNAFiles[["convert_fafile"]],
                               tRNAFiles[["convert_fafile"]],
                               ident = "rRNA_tRNA")
out_gfffile <- appendGFF(rRNAFiles[["convert_gfffile"]],
                         tRNAFiles[["convert_gfffile"]],
                         ident = "rRNA_tRNA")
```

## E. coli

```{r eco,eval=FALSE}
folder <- "genomes/Eco/"
gfffile <- paste0(folder,"eco_MG1655.gff3")
fafile <- paste0(folder,"eco_MG1655.fasta")
tRNAscanfile <- paste0(folder,"eschColi_K_12_MG1655-tRNAs.ss.sort")
matchFastaToGff(gfffile, fafile)

# Remove rRNA genes and append to fasta/gff
rRNAFiles <- convertGeneTypeToChrom(gfffile,
                                    fafile,
                                    "rRNA",
                                    "rRNA",
                                    removeDuplicateSeqs = TRUE)
# Remove specific tRNA genes and append to fasta/gff
tRNAFiles <- converttRNAscanToChrom(gfffile,
                                    fafile,
                                    tRNAscanfile,
                                    "tRNAscan")
# append all the files
out_fafile <- appendFastaFiles(rRNAFiles[["convert_fafile"]],
                               tRNAFiles[["convert_fafile"]],
                               ident = "rRNA_tRNA")
out_gfffile <- appendGFF(rRNAFiles[["convert_gfffile"]],
                         tRNAFiles[["convert_gfffile"]],
                         ident = "rRNA_tRNA")
```

## H. sapiens

```{r GRCh38,eval=FALSE}
folder <- "genomes/GRCh38/"
gfffile <- paste0(folder,"GRCh38_latest_genomic.gff")
fafile <- paste0(folder,"GRCh38_latest_genomic.fasta")
tRNAscanfile <- paste0(folder,"hg38-tRNAs.ss.sort")
matchFastaToGff(gfffile, fafile)

rRNA <- c("rna14583",
          "rna165283",
          "rna165285",
          "rna156558",
          "rna156559",
          "rna156560")

# get rRNA genes and save as fasta/gff
rRNAFiles <- convertGeneToChrom(gfffile,
                                fafile,
                                rRNA,
                                "rRNA")
# Remove specific tRNA genes and append to fasta/gff
tRNAFiles <- converttRNAscanToChrom(gfffile,
                                    fafile,
                                    tRNAscanfile,
                                    "tRNAscan")
# append all the files
out_fafile <- appendFastaFiles(rRNAFiles[["convert_fafile"]],
                               tRNAFiles[["convert_fafile"]],
                               ident = "rRNA_tRNA")
out_gfffile <- appendGFF(rRNAFiles[["convert_gfffile"]],
                         tRNAFiles[["convert_gfffile"]],
                         ident = "rRNA_tRNA")
```

# Session info

```{r sessionInfo}
sessionInfo()
```

# References